<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport"
        content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Bookshelf Apps</title>

    <!-- Connect to CSS -->
    <link rel="stylesheet" href="/css/style.css" />

    <!-- Connect to Font Awesome -->
    <link rel="stylesheet" href="fontawesome/css/all.css">

    <!-- Connect to Fonts Google -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Alumni+Sans+Inline+One:ital@0;1&family=Fascinate+Inline&family=Madimi+One&family=Monoton&family=Nosifer&family=Rampart+One&family=Rubik+Beastly&family=Rubik+Bubbles&family=Rubik+Doodle+Shadow&family=Rubik+Gemstones&family=Rubik+Moonrocks&display=swap"
        rel="stylesheet">
</head>

<style>
    * {
        padding: 0;
        margin: 0;
        box-sizing: border-box;
        font-family: 'Fascinate Inline', sans-serif;
    }

    body {
        background-color: grey;
    }

    input,
    button {
        font-size: 16px;
    }

    .head_bar {
        padding: 10px;
        width: 100%;
        display: flex;
        z-index: 999;
        position: fixed;
        align-items: center;
        justify-content: center;
        background-color: #E5E5CB;
        color: grey;
    }

    .head_bar img {
        width: 20%;
        margin-right: 50px;
    }

    .head_bar:hover {
        color: #ffffff;
    }

    main {
        max-width: 600px;
        width: 50%;
        margin: 0 auto;
        padding-top: 100px;

    }

    .input_section {
        display: flex;
        flex-direction: column;
        padding: 10px;
        border: 1px solid black;
        border-radius: 10px;
        background-color: #E5E5CB;
    }

    .input_section>h2 {
        text-align: center;
        color: grey;
    }

    .input_section>form>.input {
        margin: 8px 0;
    }

    .input_section>form>button {
        background-color: grey;
        color: white;
        border: 0;
        border-radius: 5px;
        display: block;
        width: 100%;
        padding: 8px;
        cursor: pointer;
    }

    .input_section>form>button>span {
        font-weight: bold;
    }

    .input_section>form>.input>input {
        display: block;
        width: 100%;
        padding: 8px;
        border-radius: 5px;
        background-color: grey;
        color: white;
    }


    .input_section>form>.input>label {
        color: grey;
        font-weight: bold;
    }

    .input_section>form>.input_inline {
        margin: 12px 0;
        display: flex;
        align-items: center;
    }

    .input_section>form>.input_inline>label {
        color: grey;
        font-weight: bold;
        margin-right: 10px;
    }

    .search_section {
        margin: 16px 0;
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 16px;
        border: 1px solid black;
        border-radius: 10px;
        background-color: #E5E5CB;
    }

    .search_section>h2 {
        color: grey;
    }

    .search_section>form {
        padding: 16px;
        width: 100%;
        display: grid;
        grid-template-columns: auto 1fr 0.5fr;
        grid-gap: 10px;
    }

    .search_section>form>label {
        display: flex;
        align-items: center;
        color: grey;
        font-weight: bold;
    }

    .search_section>form>input {
        padding: 5px;
        border-radius: 5px;
        background-color: grey;
        color: white;
    }

    .search_section>form>button {
        background-color: grey;
        color: white;
        border: 0;
        border-radius: 5px;
        cursor: pointer;
    }


    .rak_section {
        width: 100%;
        border: 1px solid black;
        padding: 16px;
        border-radius: 10px;
        background-color: #E5E5CB;
    }

    .rak_section h2 {
        text-align: center;
        color: grey;
    }



    .book_shelf {
        width: 100%;
        margin: 4px;
        border: 1px solid black;
        padding: 16px;
        border-radius: 10px;
        background-color: grey;
    }

    .book_shelf .completedBookList .container-books {
        padding: 8px 5px 16px 16px;
        margin: 10px 0;
        border: 1px solid black;
        border-radius: 10px;
        background-color: #161b22;
    }

    .book_shelf .uncompletedBookList .container-books {
        padding: 8px 5px 16px 16px;
        margin: 10px 0;
        border: 1px solid black;
        border-radius: 10px;
        background-color: #161b22;
    }

    .rak_section h3 {
        margin: 5px 0;
        color: #ffffff;
    }

    .rak_section h4 {
        margin: 5px 0;
        color: #c9d1d9;
        font-weight: lighter;
    }

    .rak_section button {
        border: 0;
        padding: 5px;
        margin: 0 5px 0 0;
        border-radius: 5px;
        cursor: pointer;
    }

    .rak_section .green {
        background-color: #2ea043;
        color: #c9d1d9;
    }

    .rak_section .green:hover {
        background-color: #3fb950;
    }

    .rak_section .red {
        background-color: #b62324;
        color: #c9d1d9;
    }

    .rak_section .red:hover {
        background-color: rgb(235, 80, 80);
        ;
    }

    .rak_section .finish {
        background-color: #2ea043;
        color: #c9d1d9;
    }

    .rak_section .finish:hover {
        background-color: #3fb950;
    }

    main aside {
        position: fixed;
        inset-block: 0;
        inset-inline-end: 0;
    }

    main aside .social-media {
        height: 100%;
        display: flex;
    }

    main aside .social-media ul {
        padding: 1.5rem 1rem;
        margin: auto;
        border-top-left-radius: 12px;
        border-bottom-left-radius: 12px;
        background-color: #E5E5CB;
        display: flex;
        flex-flow: column nowrap;
        align-items: center;
        justify-content: center;
        gap: 1.5rem;
    }

    main aside .social-media li {
        list-style-type: none;
    }

    main aside .social-media li a {
        text-decoration: none;
        font-size: 1.5rem;
        color: grey;
        transition: all 0.1s ease-in-out;
    }

    main aside .social-media li a:hover {
        color: #ffffff
    }


    .swal-modal {
        background-color: #161b22;
        border: 3px solid #0d1117;
    }

    .swal-icon--success:after {
        background: #161b22;
    }

    .swal-icon--success::before {
        background: #161b22;
    }

    .swal-icon--success__hide-corners {
        background: #161b22;
    }

    .swal-title {
        color: #c9d1d9;
    }

    .swal-text {
        color: #c9d1d9;
    }

    .swal-button--confirm {
        background-color: #2ea043;
    }

    .swal-button--danger {
        background-color: #b62324;
    }

    .swal-button--cancel {
        background-color: #c9d1d9;
    }

    footer {
        padding: 10px;
        margin-top: 20px;
        color: grey;
        background-color: #E5E5CB;
        text-align: center;
        font-weight: bold;
        font-size: x-large;
    }

    footer img {
        height: 150px;
    }

    footer:hover {
        color: #ffffff;
    }

    @media (max-width: 998px) {
        .book_shelf .uncompletedBookList .container-books button {
            display: flex;
            flex-direction: column;
            justify-content: center;
            width: 100%;
            align-items: center;
            margin: 10px 0 10px 0;
        }

        .book_shelf .completedBookList .container-books button {
            display: flex;
            flex-direction: column;
            justify-content: center;
            width: 100%;
            align-items: center;
            margin: 10px 0 10px 0;
        }
    }

    @media (max-width: 600px) {
        .search_section>form {
            display: flex;
            flex-direction: column;
        }

        .search_section>form>button {
            padding: 8px;
        }

        .rak_book {
            display: flex;
            flex-direction: column;
        }

        .book_shelf .uncompletedBookList .container-books button {
            display: flex;
            flex-direction: column;
            justify-content: center;
            width: 100%;
            align-items: center;
            margin: 10px 0 10px 0;
        }

        .book_shelf .completedBookList .container-books button {
            display: flex;
            flex-direction: column;
            justify-content: center;
            width: 100%;
            align-items: center;
            margin: 10px 0 10px 0;
        }
    }

    @media screen and (max-width: 768px) {
        header.head_bar {
            flex-direction: column;
        }
    }
</style>

<body>
    <header class="head_bar">
        <img src="/image/dicoding-header-logo.png" alt="">
        <h1 class="head_bar__title" id="title-bar"><i class="fas fa-book fa-pulse"></i> Bookshelf Apps <i
                class="fas fa-book fa-pulse"></i>
        </h1>
    </header>
    <main>
        <section class="input_section">
            <h2 id="title_form">Enter a New Books</h2>
            <form id="inputBook">
                <div class="input">
                    <label for="inputBookTitle">Title</label>
                    <input id="inputBookTitle" type="text" />
                </div>
                <div class="input">
                    <label for="inputBookAuthor">Author</label>
                    <input id="inputBookAuthor" type="text" />
                </div>
                <div class="input">
                    <label for="inputBookYear">Year</label>
                    <input id="inputBookYear" type="number" />
                </div>
                <div class="input_inline">
                    <label for="inputBookIsComplete">Finished Reading</label>
                    <input id="inputBookIsComplete" type="checkbox" />
                </div>
                <button id="bookSubmit" type="submit">
                    Put The Books On The <span>Book Shelf</span>
                </button>
            </form>
        </section>

        <section class="search_section">
            <h2>Search Books (Optional)</h2>
            <form id="searchBook">
                <label for="searchBookTitle">Title</label>
                <input id="searchBookTitle" type="text">
                <button id="searchSubmit" type="submit"><i class="fas fa-search fa-spin"></i> Search</button>
            </form>
        </section>


        <section class="rak_section">
            <h2>Book Shelf</h2>
            <div class="rak_book">
                <div class="book_shelf">
                    <h3>Not Finished Reading <i class="fas fa-book-open fa-spin"></i></h3>
                    <div id="incompleteBookshelfList" class="uncompletedBookList">
                    </div>
                </div>
                <div class="book_shelf">
                    <h3>Finished Reading <i class="fas fa-book-open fa-spin"></i> </h3>
                    <div id="completeBookshelfList" class="completedBookList">
                    </div>
                </div>
            </div>
        </section>

        <aside>
            <div class="social-media">
                <ul>
                    <li>
                        <a href="https://web.facebook.com/gideonleonardo.ginting" id="facebook"><i
                                class="fab fa-facebook fa-spin fa-lg"></i></a>
                    </li>
                    <li>
                        <a href="https://www.instagram.com/glginting04/" id="instagram"><i
                                class="fab fa-instagram fa-spin fa-lg"></i></a>
                    </li>
                    <li>
                        <a href="https://web.whatsapp.com/#" id="whatsapp"><i
                                class="fab fa-whatsapp fa-spin fa-lg"></i></a>
                    </li>
                    <li>
                        <a href="https://github.com/GideonLeonardo" id="github"><i
                                class="fab fa-github fa-spin"></i></a>
                    </li>
                </ul>
            </div>
        </aside>
    </main>

    <footer>
        <p>Created By: Gideon Leonardo Ginting S ðŸ™Œ &copy; 2024 </p>
        <p>Supported By: <img src="/image/My Parents.jpeg" alt="Parents"></p>
    </footer>

    <!-- Connect to Javascript -->
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
    <script src="/js/main.js"></script>
    <script>
        const books = [];
        const RENDER_BOOK = "render-book";
        const SAVED_BOOKS = "save-book";
        const STORAGE_KEY = "BOOKSHELF_APP";
        const titleBooks = document.querySelector('#inputBookTitle');
        const authorBooks = document.querySelector('#inputBookAuthor');
        const yearBooks = document.querySelector('#inputBookYear');
        const isCompleteBooks = document.querySelector('#inputBookIsComplete');

        function is_storage_exist() {
            if (typeof (Storage) === undefined) {
                alert('Browser Anda tidak support local storage')
                return false;
            }
            return true;
        }

        function generate_id() {
            return +new Date();
        }

        function generate_book(id, title, author, year, isComplete) {
            return {
                id,
                title,
                author,
                year,
                isComplete,
            }
        }

        function find_book(book_id) {
            for (const book_item of books) {
                if (book_item.id === book_id) {
                    return book_item;
                }
            }

            return null;
        }

        function find_to_index(book_id) {
            for (const index in books) {
                if (books[index].id === book_id) {
                    return index;
                }
            }
            return -1;
        }

        function make_card_book(booksObject) {
            const {
                id,
                title,
                author,
                year,
                isComplete,
            } = booksObject;

            const title_element = document.createElement("h3");
            title_element.setAttribute("id", "title-books");
            title_element.innerText = `${title}`;

            const author_element = document.createElement("h4");
            author_element.setAttribute("id", "author-books");
            author_element.innerText = `Penulis : ${author}`;

            const year_element = document.createElement("h4");
            year_element.setAttribute("id", "year-books");
            year_element.innerText = `Tahun : ${year}`;

            const container = document.createElement("div");
            container.append(title_element, author_element, year_element);
            container.setAttribute("id", `books-${id}`);
            container.classList.add("container-books");

            if (isComplete) {
                const btn_green = document.createElement("button");
                btn_green.innerHTML = '<p><i class="fa-solid fa-book-open"></i> Belum Selesai dibaca</p>';
                btn_green.classList.add("green");
                btn_green.addEventListener("click", function () {
                    handler_incomplete_to_read(id);
                    if (handler_complete_to_read !== false) {
                        swal("Succesfully added the book " + title + "ðŸ‘Œ", {
                            icon: "success",
                        });
                    } else {
                        swal("Failed the move the bookðŸ˜Œ!", {
                            icon: "error",
                        });
                    }
                });

                const btn_red = document.createElement("button");
                btn_red.innerHTML = '<p><i class="fas fa-trash fa-spin"></i> Delete Books</p>';
                btn_red.classList.add("red");
                btn_red.addEventListener("click", function () {
                    swal({
                        title: "Are you sure you want to delete the book " + title + "ðŸ™„",
                        icon: "warning",
                        buttons: ["Cancel", "Ya"],
                        dangerMode: true,
                    })
                        .then((willDelete) => {
                            if (willDelete) {
                                swal("Books " + title + " Deleted succesfullyðŸ‘Œ", {
                                    icon: "success",
                                });
                                handler_remove_book(id)
                            } else {
                                swal("The books was not deleted!");
                            }
                        });
                });
                container.append(btn_green, btn_red);
            } else {
                const btn_finish = document.createElement("button");
                btn_finish.innerHTML = '<p><i class="fa-solid fa-book"></i> Finished reading</p>';
                btn_finish.classList.add("finish");
                btn_finish.addEventListener("click", function () {
                    handler_complete_to_read(id);
                    if (handler_complete_to_read !== false) {
                        swal("You have finished reading " + title + "ðŸ¤©", {
                            icon: "success",
                        });
                    } else {
                        swal("Failed the move the bookðŸ˜Œ", {
                            icon: "error",
                        });
                    }

                });

                const btn_red = document.createElement("button");
                btn_red.innerHTML = '<p><i class="fas fa-trash fa-spin"></i> Deleted Books</p>';
                btn_red.classList.add("red");
                btn_red.addEventListener("click", function () {
                    swal({
                        title: "Are you sure you want to delete the book " + title + "ðŸ™„",
                        icon: "warning",
                        buttons: ["Cancel", "Ya"],
                        dangerMode: true,
                    })
                        .then((willDelete) => {
                            if (willDelete) {
                                swal("Book " + title + " Deleted succesfullyðŸ‘Œ", {
                                    icon: "success",
                                });
                                handler_remove_book(id)
                            } else {
                                swal("The books was not deleted!");
                            }
                        });
                });
                container.append(btn_finish, btn_red);
            }
            return container;
        }

        function reset_form_data() {
            document.getElementById('inputBookTitle').value = '';
            document.getElementById('inputBookAuthor').value = '';
            document.getElementById('inputBookYear').value = '';
            document.getElementById('inputBookIsComplete').checked = false;
            return;
        }

        function add_book() {
            const addTitleBooks = titleBooks.value;
            const addAuthorBooks = authorBooks.value;
            const addYearBooks = parseInt(yearBooks.value);
            const addIsComplete = isCompleteBooks.checked;
            const generateId = generate_id();
            const booksObject = generate_book(
                generateId,
                addTitleBooks,
                addAuthorBooks,
                addYearBooks,
                addIsComplete,
            );
            reset_form_data();
            books.push(booksObject);
            document.dispatchEvent(new Event(RENDER_BOOK));
            save_data();
        }

        function handler_complete_to_read(book_id) {
            const book_target = find_book(book_id);
            if (book_target == null) return;

            book_target.isComplete = true;
            document.dispatchEvent(new Event(RENDER_BOOK));
            save_data();
        }

        function handler_incomplete_to_read(book_id) {
            const book_target = find_book(book_id);
            if (book_target == null) return;

            book_target.isComplete = false;
            document.dispatchEvent(new Event(RENDER_BOOK));
            save_data();
        }

        function handler_remove_book(book_id) {
            const book_target = find_to_index(book_id);
            if (book_target === -1) return;
            books.splice(book_target, 1);
            document.dispatchEvent(new Event(RENDER_BOOK));
            save_data();
        }

        function save_data() {
            if (is_storage_exist()) {
                const parsed = JSON.stringify(books);
                localStorage.setItem(STORAGE_KEY, parsed);
                document.dispatchEvent(new Event(SAVED_BOOKS))
            }
        }

        function load_data_from_storage() {
            const serialize_data = localStorage.getItem(STORAGE_KEY);
            let data_obj = JSON.parse(serialize_data);

            if (data_obj !== null) {
                for (const book of data_obj) {
                    books.push(book);
                }
            }
            document.dispatchEvent(new Event(RENDER_BOOK));
        }

        function search_books() {
            let search = document.querySelector('#searchBookTitle').value;
            let returnSearch = document.getElementsByClassName('container-books');

            for (const book_item of returnSearch) {
                let title_book = book_item.innerText.toUpperCase();
                let search_book = title_book.search(search.toUpperCase());
                if (search_book != -1) {
                    book_item.style.display = '';
                } else {
                    book_item.style.display = 'none';
                }
            }
        }

        document.addEventListener("DOMContentLoaded", function () {
            const submitForm = document.querySelector('#inputBook');
            const searchForm = document.querySelector('#searchBook');
            submitForm.addEventListener("submit", (e) => {
                e.preventDefault();
                add_book();
                swal("Succesfully added the booksðŸ‘Œ", {
                    icon: "success",
                });
            });
            searchForm.addEventListener("submit", (e) => {
                e.preventDefault();
                search_books();
            });
            if (is_storage_exist()) {
                load_data_from_storage();
            }
        });

        document.addEventListener(SAVED_BOOKS, function () {
            console.log(localStorage.getItem(STORAGE_KEY));
        });

        document.addEventListener(RENDER_BOOK, function () {
            const uncompletedBookList = document.querySelector(".uncompletedBookList");
            const listCompletedBooks = document.querySelector(".completedBookList");

            uncompletedBookList.innerHTML = "";
            listCompletedBooks.innerHTML = "";

            for (const book_item of books) {
                const bookElement = make_card_book(book_item);
                if (book_item.isComplete) {
                    listCompletedBooks.append(bookElement);
                } else {
                    uncompletedBookList.append(bookElement);
                }
            }
        });
    </script>
</body>

</html>